{% extends 'base.html' %}

{% block title %}Historial de pedidos | Cuenta{% endblock %}

{% block content %}
<div class="container py-5" style="max-width: 900px; min-height: 80vh;">
    
    <div class="mb-5">
        <h1 class="fw-bold">Historial de pedidos</h1>
        <p class="text-muted">Consulta el estado de tus compras recientes, devoluciones y facturas.</p>
    </div>

    {% if pedidos %}
        <div class="d-flex flex-column gap-4">
            {% for pedido in pedidos %}
            <div class="card border rounded-0 shadow-sm overflow-hidden">
                
                <!-- Header del Pedido (Gris) -->
                <div class="card-header bg-light border-bottom p-3">
                    <div class="row text-muted small text-uppercase fw-bold">
                        <div class="col-md-3 mb-2 mb-md-0">
                            <span class="d-block text-secondary" style="font-size: 0.7rem;">Fecha del pedido</span>
                            <span class="text-dark">{{ pedido.fecha_pedido|date:"d M Y" }}</span>
                        </div>
                        <div class="col-md-3 mb-2 mb-md-0">
                            <span class="d-block text-secondary" style="font-size: 0.7rem;">Total</span>
                            <span class="text-dark">${{ pedido.total }}</span>
                        </div>
                        <div class="col-md-3 mb-2 mb-md-0">
                            <span class="d-block text-secondary" style="font-size: 0.7rem;">Enviado a</span>
                            <span class="text-dark text-truncate">{{ pedido.direccion_envio }}</span>
                        </div>
                        <div class="col-md-3 text-md-end">
                            <span class="d-block text-secondary" style="font-size: 0.7rem;">Pedido # {{ pedido.id }}</span>
                            <a href="#" class="text-decoration-none text-primary small">Ver factura</a>
                        </div>
                    </div>
                </div>

                <!-- Cuerpo del Pedido -->
                <div class="card-body p-4">
                    <div class="row align-items-center">
                        
                        <!-- Estado -->
                        <div class="col-12 mb-3">
                            <h5 class="fw-bold mb-1">
                                {% if pedido.estado == 'pagado' %}
                                    <span class="text-success"><i class="bi bi-check-circle-fill"></i> Pago Confirmado</span>
                                {% elif pedido.estado == 'enviado' %}
                                    <span class="text-primary"><i class="bi bi-truck"></i> En camino</span>
                                {% else %}
                                    {{ pedido.estado|title }}
                                {% endif %}
                            </h5>
                            <small class="text-muted">Gracias por comprar en Xbox Store.</small>
                        </div>

                        <!-- Lista de Items -->
                        <div class="col-md-8">
                            {% for item in pedido.items.all %}
                            <div class="d-flex align-items-center mb-3">
                                <!-- Miniatura -->
                                <div style="width: 60px; height: 60px; background: #f9f9f9; display: flex; align-items: center; justify-content: center; border: 1px solid #eee;" class="me-3">
                                    {% if item.producto.imagen %}
                                        <img src="{{ item.producto.imagen.url }}" alt="" style="max-width: 100%; max-height: 100%;">
                                    {% else %}
                                        <i class="bi bi-box text-muted"></i>
                                    {% endif %}
                                </div>
                                <!-- Texto -->
                                <div>
                                    <a href="#" class="fw-bold text-dark text-decoration-none hover-link">{{ item.producto.nombre }}</a>
                                    <div class="small text-muted">Cant: {{ item.cantidad }} | ${{ item.precio_unitario }}</div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>

                        <!-- Botones de Acción -->
                        <div class="col-md-4 text-md-end d-flex flex-column gap-2 mt-3 mt-md-0">
                            <button class="btn btn-xbox-primary btn-sm fw-bold">Rastrear paquete</button>
                            <button class="btn btn-outline-secondary btn-sm">Escribir opinión</button>
                            <button class="btn btn-outline-secondary btn-sm">Devolver productos</button>
                        </div>

                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-light border text-center py-5">
            <i class="bi bi-receipt display-4 text-muted mb-3"></i>
            <h3>No tienes pedidos recientes</h3>
            <p>Cuando realices una compra, aparecerá aquí.</p>
            <a href="{% url 'inicio' %}" class="btn btn-dark mt-3">Ir a la tienda</a>
        </div>
    {% endif %}

</div>

<!-- Estilo extra pequeño para hover -->
<style>
    .hover-link:hover { text-decoration: underline !important; color: #107C10 !important; }
</style>
{% endblock %}